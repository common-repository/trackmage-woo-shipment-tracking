"use strict";!function(s,i,e){var o={main:trackmageAdmin,settings:trackmageAdminSettings};function t(){0!==s("#sync-in-progress").length&&s.ajax({url:o.main.urls.ajax,method:"post",data:{action:"trackmage_get_bg_stats"},success:function(e){0!==e.ordersCount?(s("#sync-status").text("Remaining orders: ".concat(e.ordersCount)),s.ajax({url:"/wp-cron.php?doing_wp_cron",method:"get",success:function(){setTimeout(function(){t()},3e3)}})):location.reload()}})}s(e).ready(function(){s("#trackmage_workspace,  #trackmage_sync_statuses, #trackmage_sync_start_date").on("change",function(){s("#btn-save-form").removeClass("disabled").removeAttr("disabled")}),t()}),s("#trackmage-settings-general #testCredentials").on("click",function(e){var t=s(this),e=(e.preventDefault(),{action:"trackmage_test_credentials",clientId:s('#trackmage-settings-general [name="trackmage_client_id"]').val(),clientSecret:s('#trackmage-settings-general [name="trackmage_client_secret"]').val()}),a="";s.ajax({url:o.main.urls.ajax,method:"post",data:e,beforeSend:function(){trackmageToggleSpinner(t,"activate"),trackmageToggleFormElement(t,"disable")},success:function(e){trackmageToggleSpinner(t,"deactivate"),trackmageToggleFormElement(t,"enable"),"success"===e.data.status?(a=o.settings.i18n.successValidKeys,s("#btn-save-form").removeClass("disabled").removeAttr("disabled"),s("form#general-settings-form").prop("cansubmit",!0)):(a=e.data.errors?e.data.errors.join(" "):o.main.i18n.unknownError,s("form#general-settings-form").prop("cansubmit",!1),s("#btn-save-form").addClass("disabled").attr("disabled","disabled")),trackmageAlert(o.settings.i18n.testCredentials,a,e.data.status,!0)},error:function(){trackmageToggleSpinner(t,"deactivate"),trackmageToggleFormElement(t,"enable"),a=o.main.i18n.unknownError,s("form#general-settings-form").prop("cansubmit",!1),s("#btn-save-form").addClass("disabled").attr("disabled","disabled"),trackmageAlert(o.settings.i18n.testCredentials,a,response.data.status,!0)}})}),s("#trackmage-settings-general #reloadWorkspaces").on("click",function(e){var t=s(this),n=s("#trackmage_workspace"),r=(e.preventDefault(),"");s.ajax({url:o.main.urls.ajax,method:"post",data:{action:"trackmage_reload_workspaces"},beforeSend:function(){trackmageToggleSpinner(t,"activate"),trackmageToggleFormElement(t,"disable")},success:function(e){var a;trackmageToggleSpinner(t,"deactivate"),trackmageToggleFormElement(t,"enable"),"success"===e.data.status?(r=e.data.message,a=n.val(),n.find("option[value!=0]").remove(),s.each(e.data.workspaces,function(e,t){t=s("<option></option>").text(t.title).val(t.id).attr("selected",a===t.id);n.append(t)})):e.data.errors&&(r=e.data.errors.join(" ")),trackmageAlert("",r,e.data.status,!0)},error:function(){trackmageToggleSpinner(t,"deactivate"),trackmageToggleFormElement(t,"enable"),r=o.main.i18n.unknownError,trackmageAlert("",r,response.data.status,!0)}})}),s(".wrap.trackmage .section.disabled").each(function(e){var t=s(this);t.find("select, input, button").prop("disabled",!0),t.find(".input-toggle").addClass("disabled"),t.find("a, button, input").on("click",function(e){e.preventDefault()})}),s(".trackmage-input-toggle").each(function(e){var t=s(this).children(".input-toggle");s(this).children('input[type="checkbox"]').is(":checked")||t.addClass("off"),s(this).css("display","inline-block")}),s(".trackmage-input-toggle").on("click",function(e){var t=s(this).children(".input-toggle"),a=s(this).children('input[type="checkbox"]');t.hasClass("disabled")||(t.hasClass("off")?(t.removeClass("off"),a.attr("checked",!0)):(t.addClass("off"),a.attr("checked",!1)))}),s("select#trackmage_sync_statuses").selectWoo({width:"350px",ajax:{url:o.main.urls.ajax,method:"post",dataType:"json",delay:250,data:function(e){return{term:e.term,action:"trackmage_get_order_statuses"}},processResults:function(e,a){return{results:e.filter(function(e,t){return!(""!==(void 0===a.term?"":a.term)&&!e.id.toLowerCase().includes(a.term.toLowerCase())&&!e.text.toLowerCase().includes(a.term.toLowerCase()))})}}}}),s("form#general-settings-form").on("submit",function(e){var t,a,n,r;return"true"===s(this).attr("cansubmit")||(t=s(this),a=s("#trackmage_workspace").val(),r=(n=s("#trackmage_sync_statuses").val())?n.filter(function(e){return-1===o.settings.sync_statuses.indexOf(e)}):[],"0"!==o.settings.workspace&&o.settings.workspace!=a?(i.trackmageConfirmDialog("#change-workspace-dialog",function(){return!!s("#agree_to_change_cb").is(":checked")||(s("#agree_to_change_cb").parent().addClass("error").find("p.description").show(),!1)},"Confirm Workspace Change","Apply").then(function(e){"yes"===e?t.attr("cansubmit",!0).submit():t.attr("cansubmit",!1)}),!1):!("0"==o.settings.workspace&&"0"!=a||(0<r.length||0===n.length&&0<o.settings.sync_statuses.length)&&"0"!=o.settings.workspace)||(i.trackmageConfirmDialog("#trigger-sync-dialog",function(){return!0},"Settings Save Confirmation","Yes").then(function(e){if("yes"!=e)return!1;s("#trigger-sync").val("1"),s("form#general-settings-form").attr("cansubmit",!0).submit()}),!1))}),s("button#btn-trigger-sync").on("click",function(e){return i.trackmageConfirmDialog("#trigger-sync-dialog",function(){return!0},"Settings Save Confirmation","Yes").then(function(e){if("yes"!=e)return!1;s("#trigger-sync").val("1"),s("form#general-settings-form").attr("cansubmit",!0).submit()}),!1}),s("button#btn-reset-plugin").on("click",function(e){return i.trackmageConfirmDialog("#reset-dialog",function(){return!!s("#agree_reset").is(":checked")||(s("#agree_reset").parent().addClass("error").find("p.description").show(),!1)},"Reset Plugin Confirmation","Reset").then(function(e){if("yes"!=e)return!1;s("#reset-plugin").val("1"),s("form#general-settings-form").attr("cansubmit",!0).submit()}),!1}),s("#change-workspace-dialog input[type=checkbox], #reset-dialog input[type=checkbox]").on("change",function(){var e=s(this).attr("rel");s(e).val(s(this).is(":checked")?1:0)}),s("#agree_to_change_cb").on("change",function(){var e=s("#trackmage_workspace").val();s("#trigger_sync_cb").prop("disabled",!s(this).is(":checked")||0==e),s("#delete_data_cb").prop("disabled",!s(this).is(":checked"))})}(jQuery,window,document);