"use strict";!function(i,s){var o={wizard:trackmageWizard};({_instanse:null,_container:"",_progressbar:"#progressbar",_steps:[],_stepsContainer:".steps-container",_stepContainerClass:"tab-pane",_loader:".wizard-loader",_errorsContainer:".wizard-header",_validators:[],init:function(e,t){var n=this;n._container=e,n._steps=t,n._buildHtml(),n._instanse=i(this._container).bootstrapWizard({tabClass:"nav nav-pills",nextSelector:".btn-next",previousSelector:".btn-previous",finishSelector:".btn-finish",onFinish:function(e,t,a){var r=i(e).attr("id");return void 0===n._validators[r]||i("#step-"+r).find("form").eq(0).valid()?i(e).hasClass("changed")||!i(e).hasClass("completed")?(i(n._loader).show(),e=i("#step-"+r).find("input, select").serialize(),n.processStep(e+="&step="+r,r,function(){i(n._container).bootstrapWizard("finish")}),!1):void(s.location.href=o.wizard.urls.completed):(n._validators[r].focusInvalid(),!1)},onNext:function(e,t,a){var r,s=i(e).attr("id");return void 0===n._validators[s]||i("#step-"+s).find("form").eq(0).valid()?i(e).hasClass("changed")||!i(e).hasClass("completed")?(i(n._loader).show(),r=i("#step-"+s).find("input, select").serialize(),n.processStep(r+="&step="+s,s,function(){i(n._container).bootstrapWizard("next")}),!1):(i(e).addClass("completed"),i(n._errorsContainer).html(""),!0):(n._validators[s].focusInvalid(),!1)},onInit:function(e,t,a){},onTabClick:function(e,t,a){return!1},onTabShow:function(e,t,a){i(e).hasClass("reload")&&n.getStepContent(e),t.find("li").removeClass("active"),i(e).addClass("active");e=t.find("li").length,a+=1,t=t.closest(".wizard-card");e<=a?(i(t).find(".btn-next").hide(),i(t).find(".btn-finish").show()):(1==a?i(t).find(".btn-previous"):(i(t).find(".btn-next").show(),i(t).find(".btn-previous").show(),i(t).find(".btn-finish"))).hide()}}).data("bootstrapWizard")},_buildHtml:function(){var r=this;i(r._progressbar).html(""),i(r._stepsContainer).html(""),i.each(this._steps,function(e,t){var a=i('<li><a data-toggle="tab" href="#step-'+t.code+'">'+t.title+"</a></li>").attr("id",t.code).addClass("reload"),t=i("<div></div>").addClass(r._stepContainerClass).attr("id","step-"+t.code).html("Step "+t.title);i(r._progressbar).append(a),i(r._stepsContainer).append(t)})},getStepContent:function(t){var s=this,n=i(t).attr("id");i.ajax({url:o.wizard.urls.ajax,method:"post",data:{action:"trackmage_wizard_get_step_content",step:n},beforeSend:function(){i(s._loader).show()},success:function(e){var a,r;e.success&&(i("#step-"+n).html(e.data.html),i("#step-"+n).find("input, select").on("paste, change",function(){i(t).addClass("changed")}),0<(e=i("#step-"+n).find(".required")).length&&(a={},r={},i.each(e,function(e,t){t=i(t).attr("name");a[t]={required:!0},r[t]={required:"Field is required!"}}),s._validators[n]=i("#step-"+n).find("form").eq(0).validate({rules:a,messages:r,onsubmit:!1,errorElement:"div",errorPlacement:function(e,t){e.appendTo(t.parent()).addClass("invalid-feedback")},highlight:function(e,t,a){i(e).addClass("is-invalid"),i(e).parents("form").eq(0).addClass("was-validated")},unhighlight:function(e,t,a){i(e).removeClass("is-invalid"),i(e).parents("form").eq(0).addClass("was-validated")}})),e=i("#step-"+n).find(".woo-select"),i.each(e,function(e,t){s._initSelectWoo(t)}),i(t).removeClass("reload")),i(s._loader).hide()},error:function(){i(s._loader).hide(),i(s._errorsContainer).html(""),i("<div></div>").addClass("alert").addClass("alert-danger").html(o.wizard.i18n.unknownError).attr("role","alert").appendTo(i(s._errorsContainer))}})},processStep:function(t,a,r){var s=this;t+="&action=trackmage_wizard_process_step",i.ajax({url:o.wizard.urls.ajax,method:"post",data:t,beforeSend:function(){},success:function(e){e.success?(i("#"+a).addClass("completed").removeClass("changed").next().addClass("reload").removeClass("completed"),r()):"error"==e.data.status&&(i("#"+t.step).removeClass("completed").next().addClass("reload").removeClass("completed"),i(s._errorsContainer).html(""),i.each(e.data.errors,function(e,t){i("<div></div>").addClass("alert").addClass("alert-danger").html(t).attr("role","alert").appendTo(i(s._errorsContainer))}),i(s._loader).hide())},error:function(e,t,a){i(s._loader).hide(),i(s._errorsContainer).html(""),i("<div></div>").addClass("alert").addClass("alert-danger").html(o.wizard.i18n.unknownError).attr("role","alert").appendTo(i(s._errorsContainer))}})},queryStringToJSON:function(e){var e=e.split("&"),t={};return e.forEach(function(e){e=e.split("="),t[e[0]]=decodeURIComponent(e[1]||"")}),JSON.parse(JSON.stringify(t))},_initSelectWoo:function(e){i(e).selectWoo({width:"100%",ajax:{url:o.wizard.urls.ajax,method:"post",dataType:"json",delay:250,data:function(e){return{term:e.term,action:"trackmage_get_order_statuses"}},processResults:function(e,a){return{results:e.filter(function(e,t){return!(""!==(void 0===a.term?"":a.term)&&!e.id.toLowerCase().includes(a.term.toLowerCase())&&!e.text.toLowerCase().includes(a.term.toLowerCase()))})}}}})}}).init("#wizard",o.wizard.steps)}(jQuery,window,document);